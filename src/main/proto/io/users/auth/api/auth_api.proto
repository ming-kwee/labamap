syntax = "proto3";

package io.users.auth.api;

option java_outer_classname = "AuthApi";

import "google/api/annotations.proto";
import "google/protobuf/empty.proto";
import "kalix/annotations.proto";
import "io/users/auth/action/auth_action.proto";

service AuthService {
    option (kalix.codegen) = {
      value_entity: {
        name: "io.users.auth.domain.Auth"
        entity_type: "authorization"
        state: "io.users.auth.domain.AuthState"
      }
    };
  
    rpc Register(auth.action.Auth) returns (google.protobuf.Empty);

    rpc Login(GetLoginRequest) returns (auth.action.Auth) {
        option (google.api.http) = {
            post: "/login"
            body: "*"
        };
        option (kalix.method).jwt = {
            sign: MESSAGE
        };
    }
  
}

message Auth {
    string id = 1;
    // string img = 2;
    string email = 2 [(kalix.field).entity_key = true];
    string password = 3;
    string first_name = 4;
    string last_name = 5;
    string role = 6;
    string access_token = 7 [(kalix.field).jwt = {
        token: true
    }];
}

message GetLoginRequest {
    string email = 1 [(kalix.field).entity_key = true];
    string password = 2;
}